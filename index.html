<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ø§Ø¨Ø²Ø§Ø± Ø§Ù†ØªØ®Ø§Ø¨ Ø±Ù†Ú¯ Ù‡ÙˆØ´Ù…Ù†Ø¯ | Smart Color Picker</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap');
    /* Reset */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: 'Vazirmatn', sans-serif;
      background: #f0f2f5;
      color: #333;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      transition: background 0.3s, color 0.3s;
    }
    h1 {
      margin-bottom: 15px;
      font-weight: 700;
      color: #222;
    }
    .container {
      max-width: 900px;
      width: 100%;
      background: white;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
      padding: 20px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 25px;
    }
    /* Ø¨Ø®Ø´ Ø¢Ù¾Ù„ÙˆØ¯ Ø¹Ú©Ø³ */
    .upload-area {
      border: 2px dashed #888;
      border-radius: 12px;
      padding: 40px 20px;
      text-align: center;
      cursor: pointer;
      color: #666;
      transition: border-color 0.3s, color 0.3s;
    }
    .upload-area:hover {
      border-color: #4a90e2;
      color: #4a90e2;
    }
    .upload-area input {
      display: none;
    }
    .upload-area.dragover {
      border-color: #357ABD;
      color: #357ABD;
      background: #e6f0ff;
    }
    /* Ù†Ù…Ø§ÛŒØ´ Ù¾Ø§Ù„Øª Ø±Ù†Ú¯ */
    .palette {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: center;
      align-items: center;
      min-height: 160px;
    }
    .color-box {
      flex: 1 1 80px;
      height: 80px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      cursor: pointer;
      position: relative;
      transition: transform 0.2s ease;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      padding: 8px;
      color: #fff;
      font-weight: 600;
      user-select: none;
    }
    .color-box:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 15px rgba(0,0,0,0.2);
    }
    .color-label {
      background: rgba(0,0,0,0.35);
      border-radius: 6px;
      padding: 3px 6px;
      font-size: 14px;
      text-align: center;
    }
    /* Ù†Ù…Ø§ÛŒØ´ Ú©Ø¯ Ø±Ù†Ú¯ */
    .color-code {
      font-family: monospace;
      margin-top: 4px;
      font-size: 12px;
      cursor: pointer;
      opacity: 0.85;
      user-select: all;
    }
    .color-code:hover {
      opacity: 1;
    }
    /* Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø±Ù†Ú¯ Ù…Ù†ØªØ®Ø¨ */
    .details {
      grid-column: 1 / -1;
      background: #f9fafb;
      border-radius: 12px;
      padding: 20px;
      box-shadow: inset 0 0 10px rgba(0,0,0,0.03);
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      align-items: center;
      justify-content: center;
    }
    .selected-color {
      width: 100px;
      height: 100px;
      border-radius: 20px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.15);
      flex-shrink: 0;
      transition: background 0.3s;
    }
    .color-info {
      flex-grow: 1;
      font-size: 16px;
      color: #444;
      direction: ltr;
    }
    .color-info b {
      display: block;
      margin-bottom: 6px;
      font-weight: 700;
      font-size: 18px;
      color: #222;
    }
    /* Ø¯Ú©Ù…Ù‡ Ú©Ù¾ÛŒ */
    button.copy-btn {
      padding: 8px 16px;
      border: none;
      background: #4a90e2;
      color: white;
      font-weight: 700;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.25s ease;
      user-select: none;
    }
    button.copy-btn:hover {
      background: #357ABD;
    }
    /* Ø­Ø§Ù„Øª ØªØ§Ø±ÛŒÚ© */
    body.dark {
      background: #1f2128;
      color: #ddd;
    }
    body.dark .container {
      background: #282c34;
      box-shadow: 0 8px 20px rgba(0,0,0,0.8);
    }
    body.dark .upload-area {
      border-color: #aaa;
      color: #aaa;
    }
    body.dark .upload-area:hover {
      border-color: #71aaff;
      color: #71aaff;
    }
    body.dark .palette {
      /* Ø±Ù†Ú¯ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø±Ø§ ØªØºÛŒÛŒØ±ÛŒ Ù†Ù…ÛŒâ€ŒØ¯Ù‡ÛŒÙ… */
    }
    body.dark .color-box {
      box-shadow: 0 2px 8px rgba(255,255,255,0.1);
    }
    body.dark .color-label {
      background: rgba(255,255,255,0.2);
    }
    body.dark .color-info {
      color: #bbb;
    }
    body.dark button.copy-btn {
      background: #5390ff;
    }
    body.dark button.copy-btn:hover {
      background: #71aaff;
    }
    /* Ø³ÙˆÛŒÛŒÚ† Ø­Ø§Ù„Øª ØªØ§Ø±ÛŒÚ© */
    .dark-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      cursor: pointer;
      background: #4a90e2;
      padding: 8px 12px;
      border-radius: 10px;
      color: white;
      font-weight: 700;
      box-shadow: 0 4px 12px rgba(0,0,0,0.25);
      user-select: none;
      transition: background 0.3s ease;
      z-index: 1000;
    }
    .dark-toggle:hover {
      background: #357ABD;
    }
  </style>
</head>
<body>
  <div class="dark-toggle" id="darkToggle">ğŸŒ™ Ø­Ø§Ù„Øª ØªØ§Ø±ÛŒÚ©</div>

  <h1>Ø§Ø¨Ø²Ø§Ø± Ø§Ù†ØªØ®Ø§Ø¨ Ø±Ù†Ú¯ Ù‡ÙˆØ´Ù…Ù†Ø¯</h1>

  <div class="container">
    <label class="upload-area" id="uploadArea" tabindex="0">
      <input type="file" id="imageUpload" accept="image/*" />
      Ú©Ø´ÛŒØ¯Ù† Ùˆ Ø±Ù‡Ø§ Ú©Ø±Ø¯Ù† ÛŒØ§ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯ Ùˆ ØªØµÙˆÛŒØ± Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯
    </label>

    <div class="palette" id="palette">
      <!-- Ø±Ù†Ú¯â€ŒÙ‡Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
      <p style="width:100%; text-align:center; color:#999; margin-top:30px;">Ø±Ù†Ú¯â€ŒÙ‡Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯</p>
    </div>

    <div class="details" id="colorDetails" style="display:none;">
      <div class="selected-color" id="selectedColor"></div>
      <div class="color-info" id="colorInfo">
        <b>Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø±Ù†Ú¯ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡</b>
        <div>HEX: <span id="hexCode"></span> <button class="copy-btn" data-copy-target="hexCode">Ú©Ù¾ÛŒ</button></div>
        <div>RGB: <span id="rgbCode"></span> <button class="copy-btn" data-copy-target="rgbCode">Ú©Ù¾ÛŒ</button></div>
        <div>HSL: <span id="hslCode"></span> <button class="copy-btn" data-copy-target="hslCode">Ú©Ù¾ÛŒ</button></div>
      </div>
    </div>
  </div>

  <script>
    const uploadArea = document.getElementById('uploadArea');
    const imageUpload = document.getElementById('imageUpload');
    const palette = document.getElementById('palette');
    const colorDetails = document.getElementById('colorDetails');
    const selectedColor = document.getElementById('selectedColor');
    const hexCode = document.getElementById('hexCode');
    const rgbCode = document.getElementById('rgbCode');
    const hslCode = document.getElementById('hslCode');
    const darkToggle = document.getElementById('darkToggle');

    // ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø­Ø§Ù„Øª ØªØ§Ø±ÛŒÚ©
    darkToggle.onclick = () => {
      document.body.classList.toggle('dark');
      if (document.body.classList.contains('dark')) {
        darkToggle.textContent = 'â˜€ï¸ Ø­Ø§Ù„Øª Ø±ÙˆØ´Ù†';
      } else {
        darkToggle.textContent = 'ğŸŒ™ Ø­Ø§Ù„Øª ØªØ§Ø±ÛŒÚ©';
      }
    };

    // Drag & Drop Events
    uploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadArea.classList.add('dragover');
    });
    uploadArea.addEventListener('dragleave', (e) => {
      e.preventDefault();
      uploadArea.classList.remove('dragover');
    });
    uploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadArea.classList.remove('dragover');
      const file = e.dataTransfer.files[0];
      if (file && file.type.startsWith('image/')) {
        processImageFile(file);
      }
    });

    uploadArea.addEventListener('click', () => imageUpload.click());
    imageUpload.addEventListener('change', () => {
      if (imageUpload.files.length > 0) {
        processImageFile(imageUpload.files[0]);
      }
    });

    // Ø®ÙˆØ§Ù†Ø¯Ù† ÙØ§ÛŒÙ„ Ùˆ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù¾Ø§Ù„Øª Ø±Ù†Ú¯ÛŒ
    function processImageFile(file) {
      const reader = new FileReader();
      reader.onload = function(event) {
        const img = new Image();
        img.onload = () => {
          extractColors(img);
        };
        img.src = event.target.result;
      };
      reader.readAsDataURL(file);
    }

    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù¾Ø§Ù„Øª Ø±Ù†Ú¯ Ø¨Ø§ Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø±Ù†Ú¯â€ŒÙ‡Ø§ + Ø®ÙˆØ´Ù‡â€ŒØ¨Ù†Ø¯ÛŒ Ø³Ø§Ø¯Ù‡
    function extractColors(image) {
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      const width = 150; // Ø³Ø§ÛŒØ² Ù†Ù…ÙˆÙ†Ù‡â€ŒØ¨Ø±Ø¯Ø§Ø±ÛŒ
      const height = 150;
      canvas.width = width;
      canvas.height = height;
      ctx.drawImage(image, 0, 0, width, height);

      // Ú¯Ø±ÙØªÙ† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒÚ©Ø³Ù„ÛŒ
      const imgData = ctx.getImageData(0, 0, width, height);
      const pixels = imgData.data;
      const pixelCount = width * height;

      // Ø®ÙˆØ´Ù‡â€ŒØ¨Ù†Ø¯ÛŒ K-means Ø³Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªØ®Ø±Ø§Ø¬ 6 Ø±Ù†Ú¯ Ø§ØµÙ„ÛŒ
      const k = 6;
      let clusters = [];
      let assignments = new Array(pixelCount);
      // Ø´Ø±ÙˆØ¹ ØªØµØ§Ø¯ÙÛŒ Ø®ÙˆØ´Ù‡â€ŒÙ‡Ø§
      for (let i = 0; i < k; i++) {
        const pxIndex = Math.floor(Math.random() * pixelCount) * 4;
        clusters[i] = [
          pixels[pxIndex],
          pixels[pxIndex + 1],
          pixels[pxIndex + 2]
        ];
      }

      let changed = true;
      let iterations = 0;
      while (changed && iterations < 10) {
        changed = false;
        // ØªØ®ØµÛŒØµ Ù¾ÛŒÚ©Ø³Ù„â€ŒÙ‡Ø§ Ø¨Ù‡ Ø®ÙˆØ´Ù‡â€ŒÙ‡Ø§
        for (let i = 0; i < pixelCount; i++) {
          const r = pixels[i * 4];
          const g = pixels[i * 4 + 1];
          const b = pixels[i * 4 + 2];
          let minDist = Infinity;
          let bestCluster = 0;
          for (let c = 0; c < k; c++) {
            const cr = clusters[c][0];
            const cg = clusters[c][1];
            const cb = clusters[c][2];
            const dist = (r - cr) ** 2 + (g - cg) ** 2 + (b - cb) ** 2;
            if (dist < minDist) {
              minDist = dist;
              bestCluster = c;
            }
          }
          if (assignments[i] !== bestCluster) {
            assignments[i] = bestCluster;
            changed = true;
          }
        }

        // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø®ÙˆØ´Ù‡â€ŒÙ‡Ø§
        let sums = new Array(k).fill(null).map(() => [0, 0, 0]);
        let counts = new Array(k).fill(0);
        for (let i = 0; i < pixelCount; i++) {
          const clusterIdx = assignments[i];
          sums[clusterIdx][0] += pixels[i * 4];
          sums[clusterIdx][1] += pixels[i * 4 + 1];
          sums[clusterIdx][2] += pixels[i * 4 + 2];
          counts[clusterIdx]++;
        }
        for (let c = 0; c < k; c++) {
          if (counts[c] === 0) continue;
          clusters[c][0] = Math.round(sums[c][0] / counts[c]);
          clusters[c][1] = Math.round(sums[c][1] / counts[c]);
          clusters[c][2] = Math.round(sums[c][2] / counts[c]);
        }
        iterations++;
      }

      // Ù†Ù…Ø§ÛŒØ´ Ø±Ù†Ú¯â€ŒÙ‡Ø§
      showColors(clusters);
    }

    // Ù†Ù…Ø§ÛŒØ´ Ù¾Ø§Ù„Øª Ø±Ù†Ú¯â€ŒÙ‡Ø§
    function showColors(colors) {
      palette.innerHTML = '';
      colors.forEach((rgb, idx) => {
        const hex = rgbToHex(...rgb);
        const colorBox = document.createElement('div');
        colorBox.className = 'color-box';
        colorBox.style.backgroundColor = hex;
        colorBox.tabIndex = 0;
        colorBox.setAttribute('role', 'button');
        colorBox.setAttribute('aria-label', `Ø±Ù†Ú¯ Ø´Ù…Ø§Ø±Ù‡ ${idx+1} Ø¨Ø§ Ú©Ø¯ ${hex}`);
        colorBox.innerHTML = `
          <div class="color-label">Ø±Ù†Ú¯ ${idx + 1}</div>
          <div class="color-code">${hex}</div>
        `;
        colorBox.addEventListener('click', () => selectColor(rgb));
        colorBox.addEventListener('keydown', e => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            selectColor(rgb);
          }
        });
        palette.appendChild(colorBox);
      });
      colorDetails.style.display = 'none';
    }

    // Ø§Ù†ØªØ®Ø§Ø¨ Ø±Ù†Ú¯ Ùˆ Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª
    function selectColor(rgb) {
      const hex = rgbToHex(...rgb);
      selectedColor.style.backgroundColor = hex;
      hexCode.textContent = hex;
      rgbCode.textContent = `rgb(${rgb[0]}, ${rgb[1]}, ${rgb[2]})`;
      const hsl = rgbToHsl(...rgb);
      hslCode.textContent = `hsl(${hsl[0]}, ${hsl[1]}%, ${hsl[2]}%)`;
      colorDetails.style.display = 'flex';
    }

    // ØªØ¨Ø¯ÛŒÙ„ RGB Ø¨Ù‡ HEX
    function rgbToHex(r, g, b) {
      return "#" + [r, g, b].map(x => x.toString(16).padStart(2, '0')).join('');
    }

    // ØªØ¨Ø¯ÛŒÙ„ RGB Ø¨Ù‡ HSL
    function rgbToHsl(r, g, b) {
      r /= 255; g /= 255; b /= 255;
      const max = Math.max(r, g, b);
      const min = Math.min(r, g, b);
      let h, s, l = (max + min) / 2;

      if(max === min){
        h = s = 0; // achromatic
      } else {
        const d = max - min;
        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
        switch(max){
          case r: h = (g - b) / d + (g < b ? 6 : 0); break;
          case g: h = (b - r) / d + 2; break;
          case b: h = (r - g) / d + 4; break;
        }
        h /= 6;
      }
      h = Math.round(h * 360);
      s = Math.round(s * 100);
      l = Math.round(l * 100);
      return [h, s, l];
    }

    // Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù† Ù…ØªÙ† Ú©Ø¯ Ø±Ù†Ú¯ Ø¨Ù‡ Ú©Ù„ÛŒÙ¾â€ŒØ¨ÙˆØ±Ø¯
    document.querySelectorAll('button.copy-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const targetId = btn.getAttribute('data-copy-target');
        const text = document.getElementById(targetId).textContent;
        navigator.clipboard.writeText(text).then(() => {
